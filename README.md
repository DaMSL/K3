K3/core
==========

[![Build Status](https://travis-ci.org/DaMSL/K3-Core.svg?branch=master)](https://travis-ci.org/DaMSL/K3-Core)
[![Stories in Ready](https://badge.waffle.io/damsl/k3-core.png?label=ready&title=Ready)](https://waffle.io/damsl/k3-core)

K3 is a programming language for building specialized large-scale data systems.

K3 aims to separate high-performance systems design and implementation concerns from application and algorithm logic.
We empower K3 developers to create algorithms with the mindset of working on a single machine, and then facilitate the transition to a scalable service with our data systems building blocks (e.g., resource allocation, replication, data partitioning, fault tolerance).
Our language and compiler allows us to leverage powerful program analyses and statistics to realize co-design opportunities that are often lost at API boundaries in library and framework-based approaches.

K3 is a work in progress at all levels (language, compiler, cloud runtime).
You can find examples of language features, and simple algorithms in [damsl/K3-Core/examples/](examples/)

The easiest way to try out K3 is with our docker container:
https://registry.hub.docker.com/u/damsl/k3-vanilla/

From any docker installation, you can grab this with:

    $> docker pull damsl/k3-vanilla

Our docker image contains both the K3-Core and K3-Driver codebases, as well as any dependencies/libraries, etc. We're developing K3 in the Haskell language, and K3 generates C++ code. Our docker image contains all the dependencies listed below.

Dependencies
-------------
Haskell platform: https://www.haskell.org/platform/

We use [cabal](http://www.haskell.org/cabal/) for managing Haskell package and library dependencies.

For second-stage compilation:
- any Clang/LLVM (>= 3.4) or gcc (>= 4.9) version with C++14 support
- the [Boost C++ libraries](http://www.boost.org/).


Full Toolchain Installation
----------------------------
This repository contains the compiler toolchain backend implemented as a Haskell package.
To use the library, you'll also need a frontend, as found in our driver repo: http://github.com/damsl/K3-Driver

Assuming you've installed the Haskell platform:

    $> mkdir K3
    $> git clone git@github.com:DaMSL/K3-Core.git K3/K3-Core
    $> git clone git@github.com:DaMSL/K3-Driver.git K3/K3-Driver

    $> cd K3/K3-Core
    $> cabal sandbox init
    $> cabal configure
    $> cabal install --only-dependencies
    $> cabal build

    $> cd ../K3-Driver
    $> cabal sandbox init
    $> cabal sandbox add-source ../K3-Core
    $> cabal configure
    $> cabal install --only-dependencies
    $> cabal build

This will leave you with a binary in: K3-Driver/dist/build/k3/k3

Running and Deploying
----------------------
The K3 driver supports several modes of execution for testing simple programs:
- Interpreted execution
- Network simulation (in a single process)
- Multithreaded and multiprocess network execution

For example, to run [our fibonnacci example](examples/algorithms/fibonnacci.k3) on a single local peer:

    $> K3-Driver/dist/build/k3/k3 -I K3-Core/lib/k3 interpret -b -p 127.0.0.1:40000 K3-Core/examples/algorithms/fibonacci.k3

We deploy K3 on our cluster with ansible and docker (and soon Mesos).


Core Library Installation
--------------------------

This package can be compiled using:

    $> cabal configure
    $> cabal build

Additionally the API documentation can be generated by configuring as above,
followed by:

    $> cabal haddock --hyperlink-source
