build_image: damsl/k3-tests
env:
  - GHCVER=7.8.3
  - CABALVER=1.20
  - PGHOST=127.0.0.1
  - PGUSER=postgres
  - PGPASSWORD=password

install:
  - cd /k3/K3-Core
  - git pull
  - cd /k3/K3-Driver
  - git pull
  - cd /k3/K3-Mosaic
  - git pull

script:
  - service postgresql start
  - sudo -u postgres psql -c "alter user postgres password 'password'"
  - cd /k3/K3-Driver
  - cabal install --only-dependencies --disable-documentation
  - cabal configure
  - cabal build

  # Begin tests
  - cd ktrace
    # Amplab Q1:
  - ./run_test ../../K3-Core/examples/distributed/amplab/q1.k3 tests/amplab_q1 local_q1_results

notifications:
     email:
         recipients:
             - joshdub223@gmail.com
         on_success: change
         on_failure: always
