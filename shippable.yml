build_image: damsl/k3-vanilla
env:
  - GHCVER=7.8.3
  - CABALVER=1.20

install:
  - cd /k3/K3-Core
  - git pull
  - cd /k3/K3-Driver
  - git pull
  - cd /k3/K3-Mosaic
  - git pull

script:
  - cd /k3/K3-Driver
  - cabal install --only-dependencies --disable-documentation
  - cabal configure
  - cabal build
    #- scripts/tests/tests.py -l scripts/tests/passed_tests.txt
    # Compile fibonacci.k3
  - ./compile.sh -O1 ../K3-Core/examples/algorithms/fibonacci.k3
  - ./clean.sh
    # Compile rsfull.k3
  - ./compile.sh ../K3-Core/examples/sql/mosaic/rsfull.k3
  - ./clean.sh
    # Compile amplab q1.k3 and run tests
  - ./compile.sh -O1 ../K3-Core/examples/distributed/amplab/q1.k3
  - __build/A -p ./scripts/tests/cpp/sql/q1/peers.yml
  - ./scripts/tests/cpp/sql/check_result.sh /k3/K3-Driver/scripts/tests/cpp/sql/q1/
    #- ./compile.sh ../K3-Core/examples/distributed/amplab/q2.k3

notifications:
     email:
         recipients:
             - k3-developers@googlegroups.com
         on_success: change
         on_failure: always
